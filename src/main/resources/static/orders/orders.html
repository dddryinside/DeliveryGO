<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order</title>
    <link rel="stylesheet" href="../styles.css">
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            function deleteAddress(id, addressDiv) {

                fetch(`/api/delete-order/${id}`, {
                    method: 'DELETE'
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }

                        addressDiv.remove();
                    })
                    .catch(error => {
                        console.error('There was a problem with the delete operation:', error);
                        alert('Failed to delete order');
                    });
            }

            function loadUserOrders() {
                fetch('/api/get-client-orders')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        const orderContainer = document.getElementById("order-container");

                        orderContainer.innerHTML = '';

                        data.forEach(order => {
                            const addressDiv = document.createElement("div");
                            addressDiv.classList.add("container");

                            const nameElement = document.createElement("h2");
                            nameElement.textContent = order.name;

                            const startPoint = document.createElement("p");
                            startPoint.textContent = `Start point: ${order.startPoint}`;

                            const endPoint = document.createElement("p");
                            endPoint.textContent = `End point: ${order.endPoint}`;

                            const distance = document.createElement("p");
                            distance.textContent = `Distance: ${order.distance}`;

                            const size = document.createElement("p");
                            size.textContent = `Size: ${order.size}`;

                            const status = document.createElement("p");
                            status.textContent = `Status: ${order.status}`;


                            const deleteButtonElement = document.createElement("input");
                            deleteButtonElement.type = "button";
                            deleteButtonElement.value = "Delete";
                            deleteButtonElement.classList.add("delete-btn");

                            deleteButtonElement.onclick = function () {
                                deleteAddress(address.id, addressDiv);
                            };

                            addressDiv.appendChild(nameElement);
                            addressDiv.appendChild(startPoint);
                            addressDiv.appendChild(endPoint);
                            addressDiv.appendChild(distance);
                            addressDiv.appendChild(size);
                            addressDiv.appendChild(status);
                            addressDiv.appendChild(deleteButtonElement);


                            orderContainer.appendChild(addressDiv);
                        });
                    })
                    .catch(error => {
                        console.error('There was a problem with the fetch operation:', error);
                    });
            }

            loadUserOrders();
        });
    </script>
</head>
<body>
<div class="container">
    <h1>Order List</h1>
    <input type="button" onclick="location.href='/user.html';" value="Go to home" />
    <input type="button" onclick="location.href='/orders/create-order.html';" value="Create new order" />
</div>

<div id="order-container"></div>
</body>
</html>
